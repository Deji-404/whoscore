<!DOCTYPE html>
<html lang="en">
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body {font-family: "Lato", sans-serif}
.mySlides {display: none}
</style>
<body>

    <!-- Navbar -->
    <div class="w3-top">
    <div class="w3-bar w3-black w3-card">
        <a class="w3-bar-item w3-button w3-padding-large w3-hide-medium w3-hide-large w3-right" href="javascript:void(0)" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
        <a href="#" class="w3-bar-item w3-button w3-padding-large">HOME</a>
        <a href="#band" class="w3-bar-item w3-button w3-padding-large w3-hide-small">BAND</a>
        <a href="#tour" class="w3-bar-item w3-button w3-padding-large w3-hide-small">TOUR</a>
        <a href="#contact" class="w3-bar-item w3-button w3-padding-large w3-hide-small">CONTACT</a>
        <div class="w3-dropdown-hover w3-hide-small">
        <button class="w3-padding-large w3-button" title="More">MORE <i class="fa fa-caret-down"></i></button>     
        <div class="w3-dropdown-content w3-bar-block w3-card-4">
            <a href="#" class="w3-bar-item w3-button">Merchandise</a>
            <a href="#" class="w3-bar-item w3-button">Extras</a>
            <a href="#" class="w3-bar-item w3-button">Media</a>
        </div>
        </div>
        <a href="javascript:void(0)" class="w3-padding-large w3-hover-red w3-hide-small w3-right"><i class="fa fa-search"></i></a>
    </div>
    </div>

    <!-- Navbar on small screens (remove the onclick attribute if you want the navbar to always show on top of the content when clicking on the links) -->
    <div id="navDemo" class="w3-bar-block w3-black w3-hide w3-hide-large w3-hide-medium w3-top" style="margin-top:46px">
    <a href="#band" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">BAND</a>
    <a href="#tour" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">TOUR</a>
    <a href="#contact" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">CONTACT</a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">MERCH</a>
    </div>

    <!-- Page content -->
    <div class="w3-content" style="max-width:2000px;margin-top:46px">

  
 

    <!-- Ticket Modal -->
    <div id="ticketModal" class="w3-modal">
        <div class="w3-modal-content w3-animate-top w3-card-4">
        <header class="w3-container w3-teal w3-center w3-padding-32"> 
            <span onclick="document.getElementById('ticketModal').style.display='none'" 
        class="w3-button w3-teal w3-xlarge w3-display-topright">Ã—</span>
            <h2 class="w3-wide"><i class="fa fa-suitcase w3-margin-right"></i>Tickets</h2>
        </header>
        <div class="w3-container">
            <p><label><i class="fa fa-shopping-cart"></i> Tickets, $15 per person</label></p>
            <input class="w3-input w3-border" type="text" placeholder="How many?">
            <p><label><i class="fa fa-user"></i> Send To</label></p>
            <input class="w3-input w3-border" type="text" placeholder="Enter email">
            <button class="w3-button w3-block w3-teal w3-padding-16 w3-section w3-right">PAY <i class="fa fa-check"></i></button>
            <button class="w3-button w3-red w3-section" onclick="document.getElementById('ticketModal').style.display='none'">Close <i class="fa fa-remove"></i></button>
            <p class="w3-right">Need <a href="#" class="w3-text-blue">help?</a></p>
        </div>
        </div>
    </div>

    <style>
        .bet-info {
            font-size: 13px;
        }

        .team-name {
            font-size: 13px;
        }

        .team-div {
            background-color: #E9E9ED;
            padding: 5%;
        }

        #betDiv {
            width: 100%;
        }
    </style>

    <!-- The Contact Section -->
    <div class="w3-container w3-content w3-padding-64" style="max-width:800px" id="contact">
        <h2 class="w3-wide w3-center">Whoscore Demo</h2>
        <p class="w3-opacity w3-center"><i>Track your betslip!</i></p>
        <div class="w3-row w3-padding-16">

        <div class="w3-col m6 w3-margin-bottom" style="border: 0px solid #000;">
            <table>
                <!-- <tr>
                    <td class="bet-info"> Total Stake: <p style="display: inline; margin: 10px" id="totalStake"></p> <br></td>
                    <td class="bet-info"> Potential Odds: <p style="display: inline" id="odds"></p> <br></td>
                </tr>  -->
                <tr>
                    <td class="bet-info"> Total Bets:  <p style="display: inline" id="totalBets"></p><br></td>
                    <td class="bet-info"> Total Stake: <p style="display: inline; margin: 10px" id="totalStake"></p> <br></td>
                </tr>

                <!--<tr class="team-div">
                    <td class="team-name"> Napoli  <p style="display: inline" id="totalBets"></p><br></td>
                    <td class="bet-info"> Odds: <p style="display: inline" class="odds">3.17</p> </td>
                    <td class="team-name">Burnely  <br></td>

                </tr> -->

            </table>
            
            <table id="betDiv" class="">


            </table>
            
            
        </div>

        <div class="w3-col m6" style="max-width: 300px; margin: 15px;">
            <form method="post">
            <div class="w3-row-padding" style="margin:0 -16px 8px -16px">
                <input class="w3-input w3-border" type="text" placeholder="Booking Code..." required id="ticketId" name="ticketId">
                <!-- <div class="w3-half">
                <input class="w3-input w3-border" type="text" placeholder="Email" required name="Email">
                </div> -->
            </div>
            
            <select class="w3-input w3-border" name="platform" id="platform">
                <option value="bet9ja">Bet9ja</option>
                <option value="sportybet">Sportybet</option>
                <option value="betway">Betway</option>
              </select>

            <button id="loadBtn" class="w3-button w3-black w3-section w3-right" onclick="getTicket(); return false">LOAD</button>
            </form>
        </div>
        </div>
    </div>
    
    <!-- End Page Content -->
    </div>

    <!-- Footer -->
    <footer class="w3-container w3-padding-64 w3-center w3-opacity w3-light-grey w3-xlarge">
    <i class="fa fa-facebook-official w3-hover-opacity"></i>
    <i class="fa fa-instagram w3-hover-opacity"></i>
    <i class="fa fa-snapchat w3-hover-opacity"></i>
    <i class="fa fa-pinterest-p w3-hover-opacity"></i>
    <i class="fa fa-twitter w3-hover-opacity"></i>
    <i class="fa fa-linkedin w3-hover-opacity"></i>
    <p class="w3-medium">Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity=
        "sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" 
        crossorigin="anonymous">
    </script>

    <script>
        

        function getTicket(){

            console.log("clicked");
            $("#betDiv").html('');
            var ticketId =  $("#ticketId").val();
            var platform = $("#platform").val();
            let totalStake;
            let totalGames;
            let potentialOdds = 0;
            let potentialWins;

            switch (platform) {

                case "betking":

                    $.post("/ticketId",
                        {
                            ticketId: ticketId,
                            platform: platform
                        },
                        function (data, status) {
                            console.log(data);

                            $("#totalBets").html(data[1]);
                            $("#totalStake").html(data[4]);
                            $("#odds").html(data[3]);
                            $("#wins").html(data[2]);


                        }
                    );
            
                    break;
            
                case "sportybet":

                    $.post("/ticketId",
                        {
                            ticketId: ticketId,
                            platform: platform
                        },
                        function (data, status) {
                            console.log(data);
                            totalStake = 100;
                            totalGames = data.length;

                            $("#totalBets").html(totalGames);
                            $("#totalStake").html(totalStake);

                            for (const game of data) {

                                console.log(game);
                                let homeTeam = game.homeTeamName;
                                let awayTeam = game.awayTeamName;

                                for (const market of game.markets) {
                                    
                                    for (const outcome of market.outcomes) {
                                        let odds = parseFloat(outcome.odds);
                                        let results = [homeTeam, awayTeam, odds]

                                        setTable(results);
                                    }
                                }
                                
                            }
                            potentialWins = totalStake * potentialOdds;

                        }
                    );

                    break;
            
                case "betway":

                    $.post("/ticketId",
                        {
                            ticketId: ticketId,
                            platform: platform
                        },
                        function (data, status) {

                            let ss = JSON.parse(data)
                            ss = ss.Betslip;
                            
                            for (const game of ss) {
                                
                                let odd = game.PriceDecimal;
                                let gameTitle = game.EventTitle;
                                gameTitle = gameTitle.split("v");
                                let results = [gameTitle[0], gameTitle[1], odd];

                                setTable(results);
                                //console.log(game);
                            }

                        }
                    );

                    break;

                case "bet9ja":

                    $.post("/ticketId",
                        {
                            ticketId: ticketId,
                            platform: platform
                        },
                        function (data, status) {

                            let json_data = data.O;
                            let result = [];
                            
                            for(var i in json_data)
                                result.push([i, json_data [i]]);

                            //console.log(result);

                            for (const game of result) {
                                
                                let event = game[1];
                                let gameTitle = event.E_NAME;
                                let odd = event.V;
            
                                gameTitle = gameTitle.split('-');
                                let results = [gameTitle[0], gameTitle[1], odd];
                                
                                setTable(results);
                            }
                            
                        }
                    );

                    break;

                default:
                    break;
            }

            
        }

        function setTable(results) {

            let homeTeam = results[0];
            let awayTeam = results[1];
            let odds = results[2];

            const cGame = `<tr class="team-div">
                <td class="team-name"> ${homeTeam}  <p style="display: inline" id="totalBets"></p><br></td>
                <td class="bet-info"> Odds: <p style="display: inline" class="odds">${odds}</p> </td>
                <td class="team-name">${awayTeam}  <br></td>

            </tr>`;

            $("#betDiv").append(cGame);

        }
        
    </script>

    <script>
        // Automatic Slideshow - change image every 4 seconds
        var myIndex = 0;
        carousel();

        function carousel() {
        var i;
        var x = document.getElementsByClassName("mySlides");
        for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";  
        }
        myIndex++;
        if (myIndex > x.length) {myIndex = 1}    
        x[myIndex-1].style.display = "block";  
        setTimeout(carousel, 4000);    
        }

        // Used to toggle the menu on small screens when clicking on the menu button
        function myFunction() {
        var x = document.getElementById("navDemo");
        if (x.className.indexOf("w3-show") == -1) {
            x.className += " w3-show";
        } else { 
            x.className = x.className.replace(" w3-show", "");
        }
        }

        // When the user clicks anywhere outside of the modal, close it
        var modal = document.getElementById('ticketModal');
        window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
        }

       
        
    </script>

    </body>
</html>